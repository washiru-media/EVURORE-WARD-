<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>EVURORE WARD MCA RACE 2026</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
:root{
--green:#1b5e20;
--red:#b71c1c;
--black:#111;
--white:#fff;
}

body{
margin:0;
font-family:Arial, Helvetica, sans-serif;
background:linear-gradient(135deg,var(--green),var(--black));
color:var(--white);
}

.container{
max-width:420px;
margin:auto;
padding:16px;
}

h1{
font-size:22px;
font-weight:800;
text-align:center;
}

.subtitle{
font-size:14px;
text-align:center;
margin-bottom:15px;
}

.card{
background:#ffffff12;
border-radius:16px;
padding:15px;
}

.option{
background:#fff;
color:#000;
border-radius:12px;
padding:14px;
margin-bottom:10px;
display:flex;
justify-content:space-between;
align-items:center;
font-weight:600;
cursor:pointer;
}

.option button{
background:var(--green);
color:#fff;
border:none;
border-radius:20px;
padding:6px 14px;
font-size:12px;
}

.admin-btn{
text-align:center;
margin-top:10px;
text-decoration:underline;
cursor:pointer;
font-size:12px;
}

.admin-panel{
display:none;
margin-top:15px;
background:#00000050;
padding:10px;
border-radius:10px;
}

.admin-panel input{
width:70px;
padding:6px;
margin-left:5px;
}

canvas{
margin-top:20px;
background:#fff;
border-radius:12px;
padding:10px;
}

footer{
text-align:center;
font-size:11px;
margin-top:20px;
opacity:.9;
}
</style>
</head>

<body>

<div class="container">
<h1>MBEERE NORTH POLITICS POLLS</h1>
<h2>EVURORE WARD BY ELECTIONS 2026</h2>
<div class="subtitle">
Between these aspirants whom could you vote for Evurore Ward MCA Seat ðŸª‘ NB: You can only vote once ðŸ˜‚ðŸ˜‚
</div>

<div class="card" id="poll"></div>
<div id="results"></div>

<canvas id="pieChart"></canvas>

<div class="admin-btn" onclick="adminLogin()">Admin Login</div>
<div class="admin-panel" id="adminPanel"></div>

<footer>
Official Opinion Poll. System created by WA ShirÃº Media Hub Â© 0724253280 for Mpesa Support
</footer>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
// ================= FIREBASE CONFIG =================
const firebaseConfig = {
  apiKey: "AIzaSyB61J0cIHbCwh-QHwI1w2FVB72FTQKeKwo",
  authDomain: "maragua-constituency-polls.firebaseapp.com",
  databaseURL: "https://maragua-constituency-polls-default-rtdb.firebaseio.com",
  projectId: "maragua-constituency-polls",
  storageBucket: "maragua-constituency-polls.firebasestorage.app",
  messagingSenderId: "388204927669",
  appId: "1:388204927669:web:9b8a1e3bcdbfd9b1a93cfc"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const votesRef = db.ref("maragua_mp_votes_2027");
// ==================================================

const ADMIN_PASSWORD = "maragua2027";
const DEVICE_KEY = "maragua_has_voted";

const candidates = [
"Hon Albert Kigoro",
"Hon. MUKANGU Junior",
"Hon MUKUI MATE",
"HON  John wa KIGOOCO",
"HON CATHERINE",
"HON MURATIA",
"DCP CANDIDATE",
"Not Decided"
];

const poll = document.getElementById("poll");
const results = document.getElementById("results");
const adminPanel = document.getElementById("adminPanel");

let chart;

// ============ VOTING ============
function hasVoted(){
  return localStorage.getItem(DEVICE_KEY);
}

function renderPoll(){
  poll.innerHTML="";
  if(hasVoted()){
    poll.innerHTML="<b>You have already voted.</b>";
    return;
  }
  candidates.forEach(name=>{
    const div=document.createElement("div");
    div.className="option";
    div.innerHTML=`<span>${name}</span><button>VOTE</button>`;
    div.onclick=()=>castVote(name);
    poll.appendChild(div);
  });
}

function castVote(name){
  if(hasVoted()) return;
  votesRef.child(name).transaction(v => (v||0)+1);
  localStorage.setItem(DEVICE_KEY,"yes");
  alert("Vote recorded successfully.");
  renderPoll();
}

// ============ LIVE RESULTS + PIE ============
votesRef.on("value", snap=>{
  const data = snap.val() || {};
  let total = 0;
  candidates.forEach(c => total += data[c] || 0);
  total = total || 1;

  results.innerHTML="<h3 style='text-align:center'>Live Results</h3>";
  candidates.forEach(c=>{
    const p = ((data[c]||0)/total*100).toFixed(1);
    results.innerHTML += `<div>${c}: ${p}%</div>`;
  });

  updateChart(data);
});

function updateChart(data){
  const values = candidates.map(c => data[c] || 0);
  if(chart) chart.destroy();
  chart = new Chart(document.getElementById("pieChart"),{
    type:"pie",
    data:{
      labels:candidates,
      datasets:[{
        data:values,
        backgroundColor:[
          "#1b5e20","#b71c1c","#000","#4caf50",
          "#ff5722","#795548","#607d8b","#9e9e9e"
        ]
      }]
    }
  });
}

// ============ ADMIN ============
function adminLogin(){
  const pass = prompt("Enter admin password");
  if(pass === ADMIN_PASSWORD){
    adminPanel.style.display="block";
    renderAdmin();
  }else{
    alert("Wrong password");
  }
}

function renderAdmin(){
  adminPanel.innerHTML="<h4>Admin Dashboard</h4>";
  candidates.forEach(c=>{
    adminPanel.innerHTML += `
      <div>
        ${c}
        <input type="number" onchange="updateVote('${c}',this.value)">
      </div>`;
  });
  adminPanel.innerHTML += `
    <button onclick="resetVotes()">Reset All Votes</button>
    <button onclick="adminLogout()">Logout</button>
  `;
}

function updateVote(name,val){
  votesRef.child(name).set(parseInt(val)||0);
}

function resetVotes(){
  if(confirm("Reset ALL votes?")){
    votesRef.set({});
    localStorage.removeItem(DEVICE_KEY);
  }
}

function adminLogout(){
  adminPanel.style.display="none";
}

// INIT
renderPoll();
</script>

</body>
</html>
